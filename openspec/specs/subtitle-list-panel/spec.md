## ADDED Requirements

### Requirement: 字幕条目交互菜单系统

系统 SHALL 为字幕列表面板中的每个字幕条目提供丰富的交互功能，支持右键上下文菜单和悬停操作按钮两种交互方式。

#### Scenario: 用户悬停显示操作按钮

- **WHEN** 用户将鼠标悬停在字幕条目上超过 300ms
- **THEN** 系统显示常用操作的快捷按钮（AI 询问、翻译、编辑）
- **AND** 按钮不会干扰原有的点击跳转功能
- **AND** 按钮在当前主题下显示正确的样式

#### Scenario: 用户右键显示上下文菜单

- **WHEN** 用户在字幕条目上右键点击
- **THEN** 系统显示完整的上下文菜单
- **AND** 菜单包含所有可用操作（询问AI、生成翻译、编辑文本、复制文本、删除字幕等）
- **AND** 菜单位置根据屏幕边界自动调整
- **AND** 点击菜单外部或按 ESC 键关闭菜单

#### Scenario: 用户执行 AI 询问操作

- **WHEN** 用户点击"询问 AI"按钮或菜单项
- **THEN** 系统打开 AI 对话界面
- **AND** 预填充选中的字幕文本作为询问内容
- **AND** 用户可以修改询问内容并发送
- **AND** AI 响应在专门的界面中显示

#### Scenario: 用户生成翻译

- **WHEN** 用户点击"生成翻译"按钮或菜单项
- **THEN** 系统调用翻译服务对选中的字幕文本进行翻译
- **AND** 显示翻译进度指示器
- **AND** 翻译完成后更新字幕的翻译文本
- **AND** 在字幕列表中显示翻译结果

#### Scenario: 用户快速编辑字幕

- **WHEN** 用户点击"编辑"按钮或菜单项
- **THEN** 系统在原位置显示内联编辑框
- **AND** 预填充当前字幕文本
- **AND** 用户可以修改文本并保存或取消
- **AND** 保存后立即更新字幕显示

### Requirement: 交互状态管理

系统 SHALL 提供完整的交互状态管理，确保多个字幕条目的交互不会相互干扰。

#### Scenario: 同时悬停多个字幕条目

- **WHEN** 用户快速移动鼠标经过多个字幕条目
- **THEN** 只有当前悬停的字幕条目显示操作按钮
- **AND** 其他条目的按钮立即隐藏
- **AND** 避免多个按钮同时显示造成的混乱

#### Scenario: 菜单打开时的交互处理

- **WHEN** 右键菜单处于打开状态
- **THEN** 其他字幕条目的交互功能被暂时禁用
- **AND** 虚拟滚动功能正常工作
- **AND** 点击其他字幕条目关闭当前菜单并跳转到对应时间

#### Scenario: 键盘操作支持

- **WHEN** 用户使用键盘导航到字幕条目
- **THEN** 按 Enter 键执行默认操作（跳转到时间点）
- **AND** 按 Space 键显示上下文菜单
- **AND** 按 ESC 键关闭任何打开的菜单或编辑框

### Requirement: 无障碍访问支持

系统 SHALL 确保字幕交互功能对残障用户友好，支持屏幕阅读器和键盘操作。

#### Scenario: 屏幕阅读器支持

- **WHEN** 屏幕阅读器读取字幕条目
- **THEN** 正确朗读字幕文本和时间信息
- **AND** 朗读可用的操作选项
- **AND** 操作按钮具有正确的 ARIA 标签和角色

#### Scenario: 高对比度模式支持

- **WHEN** 系统处于高对比度模式
- **THEN** 所有交互元素保持足够的对比度
- **AND** 悬停和焦点状态清晰可见
- **AND** 颜色不影响功能识别

### Requirement: 性能优化

系统 SHALL 确保大量字幕条目的交互功能不会影响性能。

#### Scenario: 大量字幕的交互渲染

- **WHEN** 字幕列表包含 1000+ 条字幕
- **THEN** 只有可视区域内的字幕渲染交互元素
- **AND** 滚动性能保持在 60fps
- **AND** 内存使用量保持在合理范围内

#### Scenario: 快速滚动时的交互处理

- **WHEN** 用户快速滚动字幕列表
- **THEN** 悬停按钮不会干扰滚动体验
- **AND** 状态更新防抖处理避免频繁重渲染
- **AND** 滚动停止后才响应交互操作
