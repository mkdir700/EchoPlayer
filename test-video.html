<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>视频播放测试</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background: #1a1a1a;
        color: white;
      }
      .video-container {
        margin: 20px 0;
        border: 2px dashed #667eea;
        border-radius: 12px;
        padding: 20px;
        text-align: center;
      }
      video {
        width: 100%;
        max-width: 600px;
        height: auto;
        border-radius: 8px;
        background: #000;
      }
      input[type='file'] {
        margin: 10px 0;
        padding: 10px;
        background: #333;
        color: white;
        border: 1px solid #667eea;
        border-radius: 4px;
      }
      .info {
        background: #333;
        padding: 15px;
        border-radius: 8px;
        margin: 10px 0;
        font-family: monospace;
        font-size: 14px;
      }
      .error {
        background: #ff4d4f;
        color: white;
        padding: 10px;
        border-radius: 4px;
        margin: 10px 0;
      }
      .success {
        background: #52c41a;
        color: white;
        padding: 10px;
        border-radius: 4px;
        margin: 10px 0;
      }
    </style>
  </head>
  <body>
    <h1>🎬 视频播放功能测试</h1>

    <div class="video-container">
      <h3>选择视频文件进行测试</h3>
      <input type="file" id="videoInput" accept="video/*" />
      <video id="testVideo" controls style="display: none">您的浏览器不支持视频播放。</video>
    </div>

    <div id="info" class="info">
      <strong>环境信息：</strong><br />
      用户代理: <span id="userAgent"></span><br />
      是否支持视频: <span id="videoSupport"></span><br />
      支持的视频格式: <span id="videoFormats"></span><br />
      Electron 环境: <span id="electronEnv"></span>
    </div>

    <div id="messages"></div>

    <script>
      const videoInput = document.getElementById('videoInput')
      const testVideo = document.getElementById('testVideo')
      const messages = document.getElementById('messages')

      // 显示环境信息
      document.getElementById('userAgent').textContent = navigator.userAgent
      document.getElementById('videoSupport').textContent =
        !!document.createElement('video').canPlayType
      document.getElementById('electronEnv').textContent =
        typeof window.process !== 'undefined' ? '是' : '否'

      // 检查支持的视频格式
      const video = document.createElement('video')
      const formats = []
      if (video.canPlayType('video/mp4')) formats.push('MP4')
      if (video.canPlayType('video/webm')) formats.push('WebM')
      if (video.canPlayType('video/ogg')) formats.push('OGG')
      if (video.canPlayType('video/avi')) formats.push('AVI')
      document.getElementById('videoFormats').textContent = formats.join(', ') || '无'

      function showMessage(message, type = 'info') {
        const div = document.createElement('div')
        div.className = type
        div.textContent = message
        messages.appendChild(div)
        setTimeout(() => div.remove(), 5000)
      }

      videoInput.addEventListener('change', function (e) {
        const file = e.target.files[0]
        if (!file) return

        showMessage(
          `选择了文件: ${file.name} (${file.type}, ${(file.size / 1024 / 1024).toFixed(2)}MB)`,
          'info'
        )

        // 创建对象 URL
        const url = URL.createObjectURL(file)
        testVideo.src = url
        testVideo.style.display = 'block'

        // 监听视频事件
        testVideo.onloadstart = () => showMessage('开始加载视频...', 'info')
        testVideo.oncanplay = () => showMessage('视频可以播放了！', 'success')
        testVideo.onloadedmetadata = () => {
          showMessage(
            `视频元数据已加载 - 时长: ${testVideo.duration.toFixed(2)}秒, 尺寸: ${testVideo.videoWidth}x${testVideo.videoHeight}`,
            'success'
          )
        }
        testVideo.onerror = (e) => {
          console.error('Video error:', e)
          showMessage(
            `视频加载失败: ${testVideo.error ? testVideo.error.message : '未知错误'}`,
            'error'
          )
        }

        // 清理之前的 URL
        testVideo.onended = () => URL.revokeObjectURL(url)
      })
    </script>
  </body>
</html>
